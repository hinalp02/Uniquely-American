{"version":3,"file":"helper.js","sources":["../../../../../src/components/graph/modules/link/helper.ts"],"sourcesContent":["// Utils\nimport { getNumber, getString, getValue } from 'utils/data'\nimport { getColor, hexToBrightness } from 'utils/color'\nimport { color } from 'd3-color'\n\n// Types\nimport { GraphInputLink, GraphInputNode } from 'types/graph'\n\n// Local Types\nimport { GraphLink, GraphLinkArrowStyle, GraphCircleLabel } from '../../types'\n\n// Config\nimport { GraphConfigInterface } from '../../config'\n\n// Helpers\nimport { getX, getY } from '../node/helper'\nimport { ZoomLevel } from '../zoom-levels'\n\nexport const getPolylineData = (d: { x1: number; x2: number; y1: number; y2: number}): string => `${d.x1},${d.y1} ${(d.x1 + d.x2) / 2},${(d.y1 + d.y2) / 2} ${d.x2},${d.y2}`\n\nexport const LINK_LABEL_RADIUS = 8\nexport const LINK_MARKER_WIDTH = 12\nexport const LINK_MARKER_HEIGHT = 8\n\nexport function getLinkShift (link: GraphLink, spacing: number): { dx: number; dy: number } {\n  const sourceNode = link.source\n  const targetNode = link.target\n  const angle = Math.atan2(getY(targetNode) - getY(sourceNode), getX(targetNode) - getX(sourceNode)) - Math.PI / 2\n  const dx = Math.cos(angle) * spacing * link._direction * (link._index - (link._neighbours - 1) / 2)\n  const dy = Math.sin(angle) * spacing * link._direction * (link._index - (link._neighbours - 1) / 2)\n  return { dx, dy }\n}\n\nexport function getLinkShiftTransform (link: GraphLink, spacing: number): string {\n  const { dx, dy } = getLinkShift(link, spacing)\n  return `translate(${dx}, ${dy})`\n}\n\nexport function getLinkLabelShift (link: GraphLink, linkSpacing: number, shiftFromCenter = 0): string {\n  const x1 = getX(link.source)\n  const y1 = getY(link.source)\n  const x2 = getX(link.target)\n  const y2 = getY(link.target)\n  const angle = Math.atan2(y2 - y1, x2 - x1)\n  const perpendicularShift = getLinkShift(link, linkSpacing)\n\n  const x = x1 + 0.5 * (x2 - x1) + shiftFromCenter * Math.cos(angle) + perpendicularShift.dx\n  const y = y1 + 0.5 * (y2 - y1) + shiftFromCenter * Math.sin(angle) + perpendicularShift.dy\n  return `translate(${x}, ${y})`\n}\n\nexport function getLinkStrokeWidth<N extends GraphInputNode, L extends GraphInputLink> (\n  d: GraphLink<N, L>,\n  scale: number,\n  config: GraphConfigInterface<N, L>\n): number {\n  const m = getNumber(d, config.linkWidth, d._indexGlobal)\n  return m / Math.pow(scale, 0.5)\n}\n\nexport function getLinkBandWidth<N extends GraphInputNode, L extends GraphInputLink> (\n  d: GraphLink<N, L>,\n  scale: number,\n  config: GraphConfigInterface<N, L>\n): number {\n  const { nodeSize, linkBandWidth } = config\n  const sourceNodeSize = getNumber(d.source, nodeSize, d.source._index)\n  const targetNodeSize = getNumber(d.target, nodeSize, d.target._index)\n  const minNodeSize = Math.min(sourceNodeSize, targetNodeSize)\n  return Math.min(minNodeSize, getNumber(d, linkBandWidth, d._indexGlobal) / Math.pow(scale || 1, 0.5)) || 0\n}\n\nexport function getLinkColor<N extends GraphInputNode, L extends GraphInputLink> (link: GraphLink<N, L>, config: GraphConfigInterface<N, L>): string {\n  const { linkStroke } = config\n  const c = getColor(link, linkStroke, link._indexGlobal, true) ?? 'var(--vis-graph-link-stroke-color)'\n  return c || null\n}\n\nexport function getLinkArrow<N extends GraphInputNode, L extends GraphInputLink> (\n  d: GraphLink<N, L>,\n  scale: number,\n  config: GraphConfigInterface<N, L>\n): string {\n  const { linkArrow } = config\n  if (scale > ZoomLevel.Level2 && getString(d, linkArrow, d._indexGlobal)) {\n    return getValue<GraphLink<N, L>, GraphLinkArrowStyle>(d, linkArrow, d._indexGlobal)\n  }\n  return null\n}\n\nexport function getArrowPath (): string {\n  return `M0,0 V${LINK_MARKER_HEIGHT} L${LINK_MARKER_WIDTH},${LINK_MARKER_HEIGHT / 2} Z`\n}\n\nexport function getDoubleArrowPath (): string {\n  return `M0,${LINK_MARKER_HEIGHT / 2} L${LINK_MARKER_WIDTH},0 L${LINK_MARKER_WIDTH * 2},${LINK_MARKER_HEIGHT / 2} L${LINK_MARKER_WIDTH},${LINK_MARKER_HEIGHT} Z`\n}\n\nexport function getLinkLabelTextColor (label: GraphCircleLabel): string {\n  if (!label.color) return null\n\n  const hex = color(label.color).hex()\n  const brightness = hexToBrightness(hex)\n  return brightness > 0.65 ? 'var(--vis-graph-link-label-text-color-dark)' : 'var(--vis-graph-link-label-text-color-bright)'\n}\n"],"names":[],"mappings":"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"}