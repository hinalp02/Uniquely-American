{"version":3,"file":"map-graph.js","sources":["../../src/data-models/map-graph.ts"],"sourcesContent":["// Utils\nimport { cloneDeep, isNumber, isObject, isString } from 'utils/data'\n\n// Core Data Model\nimport { CoreDataModel } from 'data-models/core'\n\n// Types\nimport { MapLink } from 'types/map'\n\nexport type MapGraphData<AreaDatum, PointDatum, LinkDatum> = {\n  areas?: AreaDatum[];\n  points?: PointDatum[];\n  links?: LinkDatum[];\n}\n\nexport class MapGraphDataModel<AreaDatum, PointDatum, LinkDatum> extends CoreDataModel<MapGraphData<AreaDatum, PointDatum, LinkDatum>> {\n  private _areas: AreaDatum[] = []\n  private _points: PointDatum[] = []\n  private _links: MapLink<PointDatum, LinkDatum>[] = []\n\n  // Model configuration\n  public pointId: ((n: PointDatum, i: number) => string) = n => (n as unknown as {id: string}).id\n  public linkSource: ((l: LinkDatum) => number | string | PointDatum) = l => (l as unknown as {source: string}).source\n  public linkTarget: ((l: LinkDatum) => number | string | PointDatum) = l => (l as unknown as {target: string}).target\n\n  get data (): MapGraphData<AreaDatum, PointDatum, LinkDatum> {\n    return this._data\n  }\n\n  set data (data: MapGraphData<AreaDatum, PointDatum, LinkDatum>) {\n    if (!data) return\n    this._data = data\n\n    this._areas = cloneDeep(data?.areas ?? [])\n    this._points = cloneDeep(data?.points ?? [])\n\n    this._links = cloneDeep(data?.links ?? []).reduce((arr, link) => {\n      const source = this.findPoint(this.points, this.linkSource(link))\n      const target = this.findPoint(this.points, this.linkTarget(link))\n      if (source && target) arr.push({ source, target })\n      return arr\n    }, [])\n  }\n\n  get areas (): AreaDatum[] {\n    return this._areas\n  }\n\n  get points (): PointDatum[] {\n    return this._points\n  }\n\n  get links (): MapLink<PointDatum, LinkDatum>[] {\n    return this._links\n  }\n\n  private findPoint (points: PointDatum[], pointIdentifier: number | string | PointDatum): PointDatum | undefined {\n    let foundPoint: PointDatum | undefined\n    if (isNumber(pointIdentifier)) foundPoint = points[pointIdentifier as number]\n    else if (isString(pointIdentifier)) foundPoint = points.find((node, i) => this.pointId(node, i) === pointIdentifier)\n    else if (isObject(pointIdentifier)) foundPoint = points.find(node => node === pointIdentifier)\n\n    if (!foundPoint) {\n      console.warn(`Point ${pointIdentifier} is missing from the points list`)\n    }\n\n    return foundPoint\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AAeM,MAAO,iBAAoD,SAAQ,aAA6D,CAAA;AAAtI,IAAA,WAAA,GAAA;;QACU,IAAM,CAAA,MAAA,GAAgB,EAAE,CAAA;QACxB,IAAO,CAAA,OAAA,GAAiB,EAAE,CAAA;QAC1B,IAAM,CAAA,MAAA,GAAqC,EAAE,CAAA;;QAG9C,IAAO,CAAA,OAAA,GAA2C,CAAC,IAAK,CAA6B,CAAC,EAAE,CAAA;QACxF,IAAU,CAAA,UAAA,GAAqD,CAAC,IAAK,CAAiC,CAAC,MAAM,CAAA;QAC7G,IAAU,CAAA,UAAA,GAAqD,CAAC,IAAK,CAAiC,CAAC,MAAM,CAAA;KA6CrH;AA3CC,IAAA,IAAI,IAAI,GAAA;QACN,OAAO,IAAI,CAAC,KAAK,CAAA;KAClB;IAED,IAAI,IAAI,CAAE,IAAoD,EAAA;;AAC5D,QAAA,IAAI,CAAC,IAAI;YAAE,OAAM;AACjB,QAAA,IAAI,CAAC,KAAK,GAAG,IAAI,CAAA;AAEjB,QAAA,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAA,IAAI,KAAA,IAAA,IAAJ,IAAI,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAJ,IAAI,CAAE,KAAK,MAAI,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,EAAE,CAAC,CAAA;AAC1C,QAAA,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC,MAAA,IAAI,KAAA,IAAA,IAAJ,IAAI,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAJ,IAAI,CAAE,MAAM,MAAI,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,EAAE,CAAC,CAAA;QAE5C,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAA,IAAI,KAAA,IAAA,IAAJ,IAAI,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAJ,IAAI,CAAE,KAAK,MAAI,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,KAAI;AAC9D,YAAA,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAA;AACjE,YAAA,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAA;YACjE,IAAI,MAAM,IAAI,MAAM;gBAAE,GAAG,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAA;AAClD,YAAA,OAAO,GAAG,CAAA;SACX,EAAE,EAAE,CAAC,CAAA;KACP;AAED,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAM,CAAA;KACnB;AAED,IAAA,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAC,OAAO,CAAA;KACpB;AAED,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAM,CAAA;KACnB;IAEO,SAAS,CAAE,MAAoB,EAAE,eAA6C,EAAA;AACpF,QAAA,IAAI,UAAkC,CAAA;QACtC,IAAI,QAAQ,CAAC,eAAe,CAAC;AAAE,YAAA,UAAU,GAAG,MAAM,CAAC,eAAyB,CAAC,CAAA;aACxE,IAAI,QAAQ,CAAC,eAAe,CAAC;YAAE,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,KAAK,eAAe,CAAC,CAAA;aAC/G,IAAI,QAAQ,CAAC,eAAe,CAAC;AAAE,YAAA,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,KAAK,eAAe,CAAC,CAAA;QAE9F,IAAI,CAAC,UAAU,EAAE;AACf,YAAA,OAAO,CAAC,IAAI,CAAC,SAAS,eAAe,CAAA,gCAAA,CAAkC,CAAC,CAAA;AACzE,SAAA;AAED,QAAA,OAAO,UAAU,CAAA;KAClB;AACF;;;;"}