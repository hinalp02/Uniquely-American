{"version":3,"file":"init-order.js","sources":["../../lib/order/init-order.js"],"sourcesContent":["import _sortBy from 'lodash-es/sortBy'\nimport _forEach from 'lodash-es/forEach'\nimport _has from 'lodash-es/has'\nimport _range from 'lodash-es/range'\nimport _map from 'lodash-es/map'\nimport _max from 'lodash-es/max'\nimport _filter from 'lodash-es/filter'\n\n/*\n * Assigns an initial order value for each node by performing a DFS search\n * starting from nodes in the first rank. Nodes are assigned an order in their\n * rank as they are first visited.\n *\n * This approach comes from Gansner, et al., \"A Technique for Drawing Directed\n * Graphs.\"\n *\n * Returns a layering matrix with an array per layer and each layer sorted by\n * the order of its nodes.\n */\nfunction initOrder (g) {\n  const visited = {}\n\n  const simpleNodes = _filter(g.nodes(), function (v) {\n    return !g.children(v).length\n  })\n\n  const maxRank = _max(_map(simpleNodes, function (v) {\n    return g.node(v).rank\n  }))\n\n  const layers = _map(_range(maxRank + 1), function () {\n    return []\n  })\n\n  function dfs (v) {\n    if (_has(visited, v)) return\n    visited[v] = true\n    const node = g.node(v)\n    layers[node.rank].push(v)\n\n    _forEach(g.successors(v), dfs)\n  }\n\n  const orderedVs = _sortBy(simpleNodes, function (v) {\n    return g.node(v).rank\n  })\n\n  _forEach(orderedVs, dfs)\n\n  return layers\n}\n\nexport default initOrder\n"],"names":[],"mappings":";;;;;;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,SAAS,EAAE,CAAC,EAAE;AACvB,EAAE,MAAM,OAAO,GAAG,GAAE;AACpB;AACA,EAAE,MAAM,WAAW,GAAG,OAAO,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE,UAAU,CAAC,EAAE;AACtD,IAAI,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM;AAChC,GAAG,EAAC;AACJ;AACA,EAAE,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,EAAE;AACtD,IAAI,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI;AACzB,GAAG,CAAC,EAAC;AACL;AACA,EAAE,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC,EAAE,YAAY;AACvD,IAAI,OAAO,EAAE;AACb,GAAG,EAAC;AACJ;AACA,EAAE,SAAS,GAAG,EAAE,CAAC,EAAE;AACnB,IAAI,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,MAAM;AAChC,IAAI,OAAO,CAAC,CAAC,CAAC,GAAG,KAAI;AACrB,IAAI,MAAM,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,EAAC;AAC1B,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,EAAC;AAC7B;AACA,IAAI,QAAQ,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,GAAG,EAAC;AAClC,GAAG;AACH;AACA,EAAE,MAAM,SAAS,GAAG,OAAO,CAAC,WAAW,EAAE,UAAU,CAAC,EAAE;AACtD,IAAI,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI;AACzB,GAAG,EAAC;AACJ;AACA,EAAE,QAAQ,CAAC,SAAS,EAAE,GAAG,EAAC;AAC1B;AACA,EAAE,OAAO,MAAM;AACf;;;;"}