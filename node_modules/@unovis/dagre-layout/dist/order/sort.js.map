{"version":3,"file":"sort.js","sources":["../../lib/order/sort.js"],"sourcesContent":["import _last from 'lodash-es/last'\nimport _flatten from 'lodash-es/flatten'\nimport _forEach from 'lodash-es/forEach'\nimport _sortBy from 'lodash-es/sortBy'\nimport _has from 'lodash-es/has'\nimport util from '../util'\n\nfunction sort (entries, biasRight) {\n  const parts = util.partition(entries, function (entry) {\n    return _has(entry, 'barycenter')\n  })\n  const sortable = parts.lhs\n\n  const unsortable = _sortBy(parts.rhs, function (entry) {\n    return -entry.i\n  })\n\n  const vs = []\n  let sum = 0\n  let weight = 0\n  let vsIndex = 0\n  sortable.sort(compareWithBias(!!biasRight))\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex)\n\n  _forEach(sortable, function (entry) {\n    vsIndex += entry.vs.length\n    vs.push(entry.vs)\n    sum += entry.barycenter * entry.weight\n    weight += entry.weight\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex)\n  })\n\n  const result = {\n    vs: _flatten(vs, true)\n  }\n\n  if (weight) {\n    result.barycenter = sum / weight\n    result.weight = weight\n  }\n\n  return result\n}\n\nfunction consumeUnsortable (vs, unsortable, index) {\n  let last\n\n  while (unsortable.length && (last = _last(unsortable)).i <= index) {\n    unsortable.pop()\n    vs.push(last.vs)\n    index++\n  }\n\n  return index\n}\n\nfunction compareWithBias (bias) {\n  return function (entryV, entryW) {\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1\n    } else if (entryV.barycenter > entryW.barycenter) {\n      return 1\n    }\n\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i\n  }\n}\n\nexport default sort\n"],"names":[],"mappings":";;;;;;;AAOA,SAAS,IAAI,EAAE,OAAO,EAAE,SAAS,EAAE;AACnC,EAAE,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,UAAU,KAAK,EAAE;AACzD,IAAI,OAAO,IAAI,CAAC,KAAK,EAAE,YAAY,CAAC;AACpC,GAAG,EAAC;AACJ,EAAE,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAG;AAC5B;AACA,EAAE,MAAM,UAAU,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,EAAE,UAAU,KAAK,EAAE;AACzD,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC;AACnB,GAAG,EAAC;AACJ;AACA,EAAE,MAAM,EAAE,GAAG,GAAE;AACf,EAAE,IAAI,GAAG,GAAG,EAAC;AACb,EAAE,IAAI,MAAM,GAAG,EAAC;AAChB,EAAE,IAAI,OAAO,GAAG,EAAC;AACjB,EAAE,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,SAAS,CAAC,EAAC;AAC7C,EAAE,OAAO,GAAG,iBAAiB,CAAC,EAAE,EAAE,UAAU,EAAE,OAAO,EAAC;AACtD;AACA,EAAE,QAAQ,CAAC,QAAQ,EAAE,UAAU,KAAK,EAAE;AACtC,IAAI,OAAO,IAAI,KAAK,CAAC,EAAE,CAAC,OAAM;AAC9B,IAAI,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAC;AACrB,IAAI,GAAG,IAAI,KAAK,CAAC,UAAU,GAAG,KAAK,CAAC,OAAM;AAC1C,IAAI,MAAM,IAAI,KAAK,CAAC,OAAM;AAC1B,IAAI,OAAO,GAAG,iBAAiB,CAAC,EAAE,EAAE,UAAU,EAAE,OAAO,EAAC;AACxD,GAAG,EAAC;AACJ;AACA,EAAE,MAAM,MAAM,GAAG;AACjB,IAAI,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE,IAAI,CAAC;AAC1B,IAAG;AACH;AACA,EAAE,IAAI,MAAM,EAAE;AACd,IAAI,MAAM,CAAC,UAAU,GAAG,GAAG,GAAG,OAAM;AACpC,IAAI,MAAM,CAAC,MAAM,GAAG,OAAM;AAC1B,GAAG;AACH;AACA,EAAE,OAAO,MAAM;AACf,CAAC;AACD;AACA,SAAS,iBAAiB,EAAE,EAAE,EAAE,UAAU,EAAE,KAAK,EAAE;AACnD,EAAE,IAAI,KAAI;AACV;AACA,EAAE,OAAO,UAAU,CAAC,MAAM,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE;AACrE,IAAI,UAAU,CAAC,GAAG,GAAE;AACpB,IAAI,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAC;AACpB,IAAI,KAAK,GAAE;AACX,GAAG;AACH;AACA,EAAE,OAAO,KAAK;AACd,CAAC;AACD;AACA,SAAS,eAAe,EAAE,IAAI,EAAE;AAChC,EAAE,OAAO,UAAU,MAAM,EAAE,MAAM,EAAE;AACnC,IAAI,IAAI,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,EAAE;AAC/C,MAAM,OAAO,CAAC,CAAC;AACf,KAAK,MAAM,IAAI,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,EAAE;AACtD,MAAM,OAAO,CAAC;AACd,KAAK;AACL;AACA,IAAI,OAAO,CAAC,IAAI,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC;AAC5D,GAAG;AACH;;;;"}